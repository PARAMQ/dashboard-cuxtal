(window.webpackJsonp=window.webpackJsonp||[]).push([[100,48],{1221:function(t,e,n){"use strict";n.r(e);var o=n(5),r=(n(138),n(711),n(59),n(38),n(207),n(238),n(60),n(117),n(129),n(501),n(393),n(34),n(697)),c=n(696),l={name:"Binnacle",data:function(){return{openModalFilter:!1,activeModal:!1,activeViewModal:!1,activeEditModal:!1,downloadFile:!1,idBinnacle:"",binnacleSelect:{},isActive:!1,isLoadingBinnacles:!1,binnacles:[],binnaclesFilter:[],dateSelect:new Date,zoom:12,center:[-89.60984537598705,20.85610769792424],viewBinnacle:!1,temporalPoints:[[-89.60984537598705,20.85610769792424]],rotation:0,geolocPosition:void 0,arrayCoordinates:[],features:[{type:"Feature",geometry:{type:"Polygon",coordinates:r}}]}},created:function(){this.getData()},methods:{openModal:function(){this.isActive=!0},updateView:function(){this.activeViewModal=!1,this.activeEditModal=!1,this.activeModal=!1,this.getData()},openBinnacle:function(t){this.binnacleSelect=t,this.activeViewModal=!0},editBinnacle:function(t){this.binnacleSelect=t,this.activeEditModal=!0},deleteBinnacle:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var data;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,data={idbinnacle:t},n.next=4,e.$store.dispatch("modules/binnacles/deleteBinnacle",data);case 4:e.$buefy.notification.open({message:"Bitácora eliminada",duration:2500,position:"is-bottom-right",type:"is-success",hasIcon:!0}),e.getData(),n.next=10;break;case 8:n.prev=8,n.t0=n.catch(0);case 10:case"end":return n.stop()}}),n,null,[[0,8]])})))()},getData:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.isLoadingBinnacles=!0,e.next=4,t.$store.dispatch("modules/binnacles/getBinnacles");case 4:t.binnacles=e.sent,(n=t.binnacles.map((function(t){return t.date=new Date(t.date),t}))).sort((function(a,b){return b.date-a.date})),t.binnaclesFilter=n,t.isLoadingBinnacles=!1,e.next=13;break;case 11:e.prev=11,e.t0=e.catch(0);case 13:case"end":return e.stop()}}),e,null,[[0,11]])})))()},getDataFilter:function(t,e){var n=this;return Object(o.a)(regeneratorRuntime.mark((function o(){var r;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,n.isLoadingBinnacles=!0,o.next=4,n.$store.dispatch("modules/binnacles/getBinnacles");case 4:n.binnacles=o.sent,(r=n.binnacles.filter((function(n){if(n.date=new Date(n.date),n.date.getFullYear()===e&&n.date.getMonth()===t)return n}))).length>0?(r.sort((function(a,b){return b.date-a.date})),n.binnaclesFilter=r):n.binnaclesFilter=[],n.openModalFilter=!1,n.isLoadingBinnacles=!1,o.next=13;break;case 11:o.prev=11,o.t0=o.catch(0);case 13:case"end":return o.stop()}}),o,null,[[0,11]])})))()},getBinnacle:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$store.dispatch("modules/binnacles/getBinnacle",t);case 3:return o=n.sent,n.abrupt("return",o);case 7:n.prev=7,n.t0=n.catch(0);case 9:case"end":return n.stop()}}),n,null,[[0,7]])})))()},filterBinnacle:function(text){text&&text.length>0?this.binnaclesFilter=this.binnacles.filter((function(t){if(t.number.toUpperCase().includes(text.toUpperCase()))return t})):this.binnaclesFilter=this.binnacles},viewInMap:function(option){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.viewBinnacle=!1,t.temporalPoints=[[-89.60984537598705,20.85610769792424]],e.next=4,t.getBinnacle(option);case 4:(n=e.sent).points=[],n.coordinates_binnacle.forEach((function(object){var e=[object.x,object.y],o=t.convertCoordinatesToUtm(e);n.points.push(o)})),n.points.length>0?(t.temporalPoints=n.points,t.viewBinnacle=!0):t.$buefy.notification.open({message:"La bitácora no contiene coordenadas.",duration:2500,position:"is-bottom-right",type:"is-warning",hasIcon:!0});case 9:case"end":return e.stop()}}),e)})))()},convertCoordinatesToUtm:function(t){var e=c.toLatLon(t[0],t[1],"16","T");return[e.longitude,e.latitude]},getWord:function(t,e){var n=this;return Object(o.a)(regeneratorRuntime.mark((function o(){var r,c,l,link,d,v,f;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,n.isLoadingBinnacles=!0,n.downloadFile=!0,o.next=5,n.$store.dispatch("modules/binnacles/getWordBinnacle",t);case 5:r=o.sent,c=new Blob([r],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),l=window.URL.createObjectURL(c),link=document.createElement("a"),d=e.substring(e.length-4,e.length),v=e.substring(0,e.length-4),f="bitácora_"+v+"-"+d+".docx",link.href=l,link.setAttribute("download",f),link.click(),window.URL.revokeObjectURL(l),n.isLoadingBinnacles=!1,n.downloadFile=!1,o.next=23;break;case 20:o.prev=20,o.t0=o.catch(0),n.downloadFile=!1;case 23:return o.prev=23,n.downloadFile=!1,o.finish(23);case 26:case"end":return o.stop()}}),o,null,[[0,20,23,26]])})))()}}},d=(n(955),n(76)),component=Object(d.a)(l,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"columns",attrs:{id:"map"}},[e("b-loading",{attrs:{"is-full-page":!0,"can-cancel":!1},model:{value:t.isLoadingBinnacles,callback:function(e){t.isLoadingBinnacles=e},expression:"isLoadingBinnacles"}}),t._v(" "),e("div",{staticClass:"column is-4"},[e("section",{staticClass:"m-2 has-text-centered"},[e("b-tooltip",{attrs:{label:"Crea una nueva bitácora sin la necesidad de un recorrido",position:"is-right"}},[e("b-button",{attrs:{label:"Nueva bitácora extraordinaria",type:"is-light"},on:{click:function(e){t.activeModal=!0}}})],1)],1),t._v(" "),e("section",{staticClass:"m-2 has-text-centered"},[e("b-field",{attrs:{label:"Buscar bitácoras por folio"}},[e("b-autocomplete",{attrs:{placeholder:"Ejemplo: CIV/0012023",data:t.binnaclesFilter,clearable:t.clearable},on:{typing:t.filterBinnacle,select:function(option){return t.openBinnacle(option)}},scopedSlots:t._u([{key:"default",fn:function(n){return[e("div",{staticClass:"media"},[e("div",{staticClass:"media-content"},[e("h1",[t._v(t._s(n.option.number))])])])]}}])})],1)],1),t._v(" "),e("section",{staticClass:"m-2 has-text-centered"},[e("b-button",{on:{click:function(e){t.openModalFilter=!0}}},[t._v("Filtrar por mes y año")]),t._v(" "),e("month-picker-filter",{attrs:{"is-open":t.openModalFilter},on:{close:function(e){t.openModalFilter=!1},getData:t.getDataFilter}})],1),t._v(" "),e("div",{staticClass:"columns m-2 binnalces"},[e("div",{staticClass:"column"},t._l(t.binnaclesFilter,(function(n){return e("div",{key:n.idbinnacle},[e("div",{staticClass:"card"},[e("div",{staticClass:"card-header"},[e("div",{staticClass:"level m-1 full-w"},[e("div",{staticClass:"level-left"},[e("div",{staticClass:"level-item"},[e("p",[t._v(t._s(n.number))])]),t._v(" "),e("div",{staticClass:"level-item"},["revisado"===n.status?e("b-tooltip",{attrs:{label:"Revisado",position:"is-left"}},[e("b-icon",{attrs:{icon:"check-circle",size:"is-small",type:"is-success"}})],1):"en-revision"===n.status?e("b-tooltip",{attrs:{label:"En revisión",position:"is-left"}},[e("b-icon",{attrs:{icon:"clock",size:"is-small",type:"is-warning"}})],1):"por-revisar"===n.status?e("b-tooltip",{attrs:{label:"Por revisar",position:"is-left"}},[e("b-icon",{attrs:{icon:"clock",size:"is-small",type:"is-light"}})],1):e("b-tooltip",{attrs:{label:"Sin estado",position:"is-left"}},[e("b-icon",{attrs:{icon:"alert",size:"is-small",type:"is-danger"}})],1)],1)]),t._v(" "),e("div",{staticClass:"level-right"},[e("div",{staticClass:"level-item"},[e("b-button",{attrs:{type:"is-info is-light","icon-right":"eye-outline"},on:{click:function(e){return t.openBinnacle(n)}}})],1),t._v(" "),e("div",{staticClass:"level-item"},[e("b-button",{attrs:{type:"is-danger is-light","icon-right":"delete-empty-outline"},on:{click:function(e){return t.deleteBinnacle(n.idbinnacle)}}})],1),t._v(" "),e("div",{staticClass:"level-item"},[e("b-button",{attrs:{type:"is-success is-light","icon-right":"file-word"},on:{click:function(e){return t.getWord(n.idbinnacle,n.number)}}})],1)])])]),t._v(" "),e("div",{staticClass:"card-content",on:{click:function(e){return t.viewInMap(n.idbinnacle)}}},[e("p",[e("strong",[t._v("Fecha: ")]),t._v("\n                "+t._s(n.date?n.date.getDate()+"/"+(n.date.getMonth()+1)+"/"+n.date.getFullYear():"No hay fecha registrada")+"\n              ")]),t._v(" "),e("br")]),t._v(" "),e("div",{staticClass:"m-2"},[e("p",{staticClass:"has-text-grey"},[t._v("\n                "+t._s(n.isextraordinary?"Bitácora extraordinaria":"Bitácora relacionada a un recorrido programado")+"\n              ")])])])])})),0)])]),t._v(" "),e("div",{staticClass:"column is-8"},[e("vl-map",{staticStyle:{height:"100%"},attrs:{"load-tiles-while-animating":!0,"load-tiles-while-interacting":!0,"data-projection":"EPSG:4326"}},[e("vl-view",{attrs:{zoom:t.zoom,center:t.center,rotation:t.rotation},on:{"update:zoom":function(e){t.zoom=e},"update:center":function(e){t.center=e},"update:rotation":function(e){t.rotation=e}}}),t._v(" "),e("vl-layer-tile",[e("vl-source-osm")],1),t._v(" "),t.viewBinnacle?e("vl-feature",[e("vl-geom-multi-point",{attrs:{coordinates:t.temporalPoints}})],1):t._e(),t._v(" "),e("vl-layer-vector",[e("vl-source-vector",{attrs:{features:t.features},on:{"update:features":function(e){t.features=e}}})],1)],1)],1),t._v(" "),e("new-binnacle",{attrs:{"active-modal":t.activeModal,plannification:null,"is-extraordinary":!0},on:{close:t.updateView,save:t.updateView}}),t._v(" "),e("view-binnacle",{attrs:{"active-modal":t.activeViewModal,"binnacle-object":t.binnacleSelect,"disable-form":!0},on:{close:t.updateView}}),t._v(" "),e("edit-binnacle",{attrs:{"active-modal":t.activeEditModal,"binnacle-object":t.binnacleSelect},on:{close:t.updateView,save:t.updateView}}),t._v(" "),e("b-notification",{attrs:{type:"is-info is-light",closable:!1},model:{value:t.downloadFile,callback:function(e){t.downloadFile=e},expression:"downloadFile"}},[t._v("\n    Descargando bitácora\n  ")])],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{MonthPickerFilter:n(726).default,NewBinnacle:n(794).default,ViewBinnacle:n(918).default,EditBinnacle:n(919).default})},691:function(t,e,n){t.exports=n.p+"img/background.461462f.jpg"},705:function(t,e,n){"use strict";var o=n(33),r=n(242).findIndex,c=n(330),l="findIndex",d=!0;l in[]&&Array(1)[l]((function(){d=!1})),o({target:"Array",proto:!0,forced:d},{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),c(l)},711:function(t,e,n){"use strict";var o=n(33),r=n(39),c=n(169),l=n(139),d=n(170),v=n(505),f=n(72),m=n(40),h=n(504),w=n(395),k=n(712),x=n(713),y=n(267),_=n(714),B=[],C=r(B.sort),F=r(B.push),M=m((function(){B.sort(void 0)})),D=m((function(){B.sort(null)})),L=w("sort"),R=!m((function(){if(y)return y<70;if(!(k&&k>3)){if(x)return!0;if(_)return _<603;var code,t,e,n,o="";for(code=65;code<76;code++){switch(t=String.fromCharCode(code),code){case 66:case 69:case 70:case 72:e=3;break;case 68:case 71:e=4;break;default:e=2}for(n=0;n<47;n++)B.push({k:t+n,v:e})}for(B.sort((function(a,b){return b.v-a.v})),n=0;n<B.length;n++)t=B[n].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return"DGBEFHACIJK"!==o}}));o({target:"Array",proto:!0,forced:M||!D||!L||!R},{sort:function(t){void 0!==t&&c(t);var e=l(this);if(R)return void 0===t?C(e):C(e,t);var n,o,r=[],m=d(e);for(o=0;o<m;o++)o in e&&F(r,e[o]);for(h(r,function(t){return function(e,n){return void 0===n?-1:void 0===e?1:void 0!==t?+t(e,n)||0:f(e)>f(n)?1:-1}}(t)),n=d(r),o=0;o<n;)e[o]=r[o++];for(;o<m;)v(e,o++);return e}})},712:function(t,e,n){var o=n(241).match(/firefox\/(\d+)/i);t.exports=!!o&&+o[1]},713:function(t,e,n){var o=n(241);t.exports=/MSIE|Trident/.test(o)},714:function(t,e,n){var o=n(241).match(/AppleWebKit\/(\d+)\./);t.exports=!!o&&+o[1]},726:function(t,e,n){"use strict";n.r(e);n(705);var o={name:"MonthPickerFilter",components:{MonthPicker:n(268).a},props:{isOpen:{type:Boolean,default:!1}},data:function(){return{date:{from:null,to:null,month:null,year:null},meses:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]}},methods:{showDate:function(t){var e=this;this.date=t,this.date.month=this.meses.findIndex((function(t){return t===e.date.month}))}}},r=n(76),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("b-modal",{attrs:{"can-cancel":!1},model:{value:t.isOpen,callback:function(e){t.isOpen=e},expression:"isOpen"}},[e("div",{staticClass:"modal-card",staticStyle:{width:"auto"}},[e("header",{staticClass:"modal-card-head"},[e("p",{staticClass:"modal-card-title"},[t._v("\n        Filtrar por año y mes\n      ")]),t._v(" "),e("button",{staticClass:"delete",attrs:{type:"button"},on:{click:function(e){return t.$emit("close")}}})]),t._v(" "),e("div",{staticClass:"modal-card-body is-flex is-flex-direction-row is-justify-content-center"},[e("month-picker",{attrs:{lang:"es"},on:{change:t.showDate}})],1),t._v(" "),e("footer",{staticClass:"modal-card-foot"},[e("b-button",{attrs:{label:"Filtrar"},on:{click:function(e){return t.$emit("getData",t.date.month,t.date.year)}}})],1)])])}),[],!1,null,null,null);e.default=component.exports},798:function(t,e,n){var content=n(956);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(137).default)("17929ef6",content,!0,{sourceMap:!1})},955:function(t,e,n){"use strict";n(798)},956:function(t,e,n){var o=n(136),r=n(498),c=n(691),l=o((function(i){return i[1]})),d=r(c);l.push([t.i,".full-w{width:100%!important}.binnalces{height:650px;overflow-y:scroll}#map{min-height:75vh}.card{background-color:#fff!important}.hero.is-cuxtal{background-color:rgba(4,3,3,.604);background-image:url("+d+");background-origin:content-box;background-position:50%;background-repeat:no-repeat;background-size:100%}.modal-background{background-color:rgba(0,0,0,.568)}",""]),l.locals={},t.exports=l}}]);