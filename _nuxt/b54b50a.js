(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{1268:function(t,e,n){"use strict";n.r(e);n(128),n(61),n(58),n(70),n(71);var r=n(5),o=n(26),c=(n(136),n(38),n(60),n(59),n(207),n(237),n(238),n(388),n(117),n(129),n(497),n(389),n(35),n(152)),l=n(737);function d(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}var f={name:"EditBinnacle",props:{activeModal:{default:!1,type:Boolean},idPlan:{default:"",type:String},idBinnacle:{default:"",type:String}},data:function(){return{form:{status:"sin-revisar",date:new Date,hour_init:new Date},isLoading:!1,filteredParticipants:[],filteredVehicles:[],participants:[],vehicles:[],plan:{},binnacles:[],zoom:12,center:[0,0],point:[-89.60984537598705,20.85610769792424],rotation:0,files:[],formCoord:{},points:[],idPoints:[],idEvidences:[],pointsMap:[[-89.60984537598705,20.85610769792424]],temporalFiles:[],typeBinnacle:null,temporalFile:null,buttonDisabled:!1,imageUrl:n(500)}},watch:{idBinnacle:function(t,e){t?this.getBinnacle(t):e&&!t&&this.getBinnacle(e)},isExtraordinary:function(t,e){t&&(this.isExtraordinary=t)}},computed:function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({},Object(c.b)(["user"])),created:function(){},mounted:function(){this.center=this.point?this.point:[0,0],this.form.idusers=this.user.idusers,this.form.idplanification=this.idPlan,this.getVehicles(),this.getParticipants(),this.filteredParticipants=this.participants},methods:{kmlFormatFactory:function(){return new l.a},getBinnacle:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$store.dispatch("modules/binnacles/getBinnacle",t);case 3:(r=n.sent).date=new Date(r.date),r.hour_end=new Date(r.hour_end),r.hour_init=new Date(r.hour_init),e.form=r,n.next=12;break;case 10:n.prev=10,n.t0=n.catch(0);case 12:case"end":return n.stop()}}),n,null,[[0,10]])})))()},createBinnacle:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isLoading=!0,t.buttonDisabled=!0,n=JSON.parse(JSON.stringify(t.form)),e.prev=3,e.next=6,t.updateBinnacle(n);case 6:if(!(t.points.length>0)){e.next=13;break}return t.points.map((function(e){var n=e;return n.idbinnacle=t.idBinnacle,n})),e.next=10,t.createPoints(t.points,t.idBinnacle);case 10:return n.list_coordinates=t.idPoints,e.next=13,t.updateBinnacle(n);case 13:if(!(t.files.length>0)){e.next=24;break}return r=new FormData,t.files.map((function(t){r.append("binnacle_photo[]",t)})),t.files.forEach((function(e,n){t.temporalFiles.push({description:"evidencia "+(n+1),idbinnacle:t.idBinnacle,position:n+1})})),n.list_image=t.temporalFiles,e.next=20,t.updateBinnacle(n);case 20:return o=e.sent,t.temporalFiles.forEach((function(t,e){r.append("idimages["+e+"]",o[e])})),e.next=24,t.uploadEvidences(r);case 24:t.form={},t.temporalFiles=[],t.files=[],t.idPoints=[],t.points=[-89.60984537598705,20.85610769792424],t.pointsMap=[[-89.60984537598705,20.85610769792424]],t.$buefy.toast.open({message:"¡Bitácora guardada!",type:"is-success"}),t.buttonDisabled=!1,t.isLoading=!1,n.status,t.$emit("update"),e.next=39;break;case 37:e.prev=37,e.t0=e.catch(3);case 39:return e.prev=39,t.buttonDisabled=!1,t.isLoading=!1,e.finish(39);case 43:case"end":return e.stop()}}),e,null,[[3,37,39,43]])})))()},readFile:function(){this.temporalFile=this.$refs.file.files[0]},closeModal:function(){this.form={},this.temporalFiles=[],this.files=[],this.points=[],this.$emit("close")},createPoints:function(t,e){var n=this,o=t;try{o.forEach(function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(r){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.$store.dispatch("modules/coordinates/createOrUpdateCoordinate",r);case 2:o=t.sent,n.idPoints.push({idcoordinates:o,idbinnacle:e});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}catch(t){this.$buefy.toast.open({message:"Ocurrió un error, intente nuevamente",type:"is-danger"})}},uploadEvidences:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$store.dispatch("modules/binnacles/uploadEvidences",t);case 3:r=n.sent,e.idEvidences=r,n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),e.$buefy.toast.open({message:"Ocurrió un error, intente nuevamente",type:"is-danger"});case 10:case"end":return n.stop()}}),n,null,[[0,7]])})))()},updateBinnacle:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$store.dispatch("modules/binnacles/createOrUpdateBinnacle",t);case 3:return r=n.sent,n.abrupt("return",r);case 7:n.prev=7,n.t0=n.catch(0),e.$buefy.toast.open({message:"Ocurrió un error, intente nuevamente",type:"is-danger"});case 10:case"end":return n.stop()}}),n,null,[[0,7]])})))()},getVehicles:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$store.dispatch("modules/vehicles/getVehicles");case 3:n=e.sent,t.vehicles=n,e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})))()},getParticipants:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$store.dispatch("modules/participants/getParticipants");case 3:n=e.sent,t.participants=n,e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})))()},filterData:function(text){this.filteredParticipants=this.participants.filter((function(option){if(option.name&&option.name.toString().toLowerCase().includes(text.toLowerCase()))return option}))},addPoint:function(){if(this.formCoord.name&&""!==this.formCoord.name){if(0===this.points.length){var t=[[this.point[0],this.point[1]]];this.pointsMap=t}else this.pointsMap.push([this.point[0],this.point[1]]);this.formCoord.x=this.point[0],this.formCoord.y=this.point[1],this.points.push(this.formCoord),this.formCoord={name:"",x:0,y:0},this.point=[-89.60984537598705,20.85610769792424]}else this.$buefy.toast.open({duration:4e3,message:"Es necesario asignar un nombre a las coordenadas",position:"is-bottom",type:"is-danger"})},viewPoint:function(t){this.formCoord.name=t.name,this.point[0]=t.x,this.point[1]=t.y,this.center=this.point},deletePoint:function(t){this.points.splice(t,1),this.pointsMap.splice(t,1)},removeParticipant:function(t){this.form.participants.splice(t,1)},viewIamge:function(image){this.imageUrl=URL.createObjectURL(image)},deleteDropFile:function(t){this.files.splice(t,1)},createCoord:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.formCoord.x=t.point[0],t.formCoord.y=t.point[1],e.prev=2,e.next=5,t.$store.dispatch("/modules/coordinates/createOrUpdateCoordinate",t.formCoord);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:case"end":return e.stop()}}),e,null,[[2,7]])})))()},filterVehicles:function(text){this.filteredVehicles=this.vehicles.filter((function(option){if(option.plates&&option.plates.toString().toLowerCase().includes(text.toLowerCase())||option.number&&option.number.toString().toLowerCase().includes(text.toLowerCase()))return option}))}}},m=f,v=n(89),component=Object(v.a)(m,(function(){var t=this,e=t._self._c;return e("b-modal",{attrs:{"can-cancel":!1,"destroy-on-hide":!1},model:{value:t.activeModal,callback:function(e){t.activeModal=e},expression:"activeModal"}},[e("div",{staticClass:"card"},[e("b-loading",{attrs:{"is-full-page":!1,"can-cancel":!1},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}}),t._v(" "),e("div",{staticClass:"card-header"},[e("p",{staticClass:"card-header-title"},[t._v("\n        Editar bitácora\n      ")])]),t._v(" "),e("div",{staticClass:"card-content"},[e("div",{staticClass:"content"},[e("form",{on:{submit:function(e){return e.preventDefault(),t.submit.apply(null,arguments)}}},[e("div",{staticClass:"divider"},[e("strong",[t._v("Estado de la bítacora")])]),t._v(" "),e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[e("b-field",{attrs:{label:"Estado actual de la bitácora"}},[e("b-select",{attrs:{placeholder:"Selecciona una opción"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[e("option",{attrs:{value:"sin-revisar"}},[t._v("\n                    Sin revisar\n                  ")]),t._v(" "),e("option",{attrs:{value:"en-revision"}},[t._v("\n                    En revisión\n                  ")]),t._v(" "),e("option",{attrs:{value:"revisado"}},[t._v("\n                    Revisado\n                  ")])])],1)],1)]),t._v(" "),e("div",{staticClass:"divider"},[e("strong",[t._v("Relatoría")])]),t._v(" "),e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[e("b-field",{attrs:{label:"Escriba aquí la relatoría"}},[e("b-input",{attrs:{type:"textarea"},model:{value:t.form.rapporteur,callback:function(e){t.$set(t.form,"rapporteur",e)},expression:"form.rapporteur"}})],1)],1)]),t._v(" "),e("div",{staticClass:"divider"},[e("strong",[t._v("Datos generales")])]),t._v(" "),e("div",{staticClass:"columns has-text-centered"},[e("div",{staticClass:"column"},[e("b-field",{attrs:{label:"Fecha"}},[e("b-datepicker",{attrs:{inline:""},model:{value:t.form.date,callback:function(e){t.$set(t.form,"date",e)},expression:"form.date"}})],1)],1),t._v(" "),e("div",{staticClass:"column"},[e("div",{staticClass:"container m-2"},[e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[e("b-field",{attrs:{label:"Hora de inicio"}},[e("b-timepicker",{attrs:{inline:""},model:{value:t.form.hour_init,callback:function(e){t.$set(t.form,"hour_init",e)},expression:"form.hour_init"}})],1)],1),t._v(" "),e("div",{staticClass:"column"},[e("b-field",{attrs:{label:"Hora de finalización"}},[e("b-timepicker",{attrs:{inline:""},model:{value:t.form.hour_end,callback:function(e){t.$set(t.form,"hour_end",e)},expression:"form.hour_end"}})],1)],1)])]),t._v(" "),e("br"),t._v(" "),e("div",{staticClass:"container m-2"},[e("b-field",{attrs:{label:"Vehículos"}},[e("b-taginput",{attrs:{data:t.filteredVehicles,field:"number",autocomplete:""},on:{typing:t.filterVehicles},scopedSlots:t._u([{key:"default",fn:function(n){return[e("strong",[t._v(t._s(n.option.number)+" -\n                        "+t._s(n.option.plates?n.option.plates:"sin placas reigstradas"))])]}},{key:"empty",fn:function(){return[t._v("\n                      Sin resultados\n                    ")]},proxy:!0}]),model:{value:t.form.vehicles,callback:function(e){t.$set(t.form,"vehicles",e)},expression:"form.vehicles"}})],1),t._v(" "),e("b-field",{attrs:{label:"Participantes"}},[e("b-taginput",{attrs:{data:t.filteredParticipants,field:"name",autocomplete:""},on:{typing:t.filterData},scopedSlots:t._u([{key:"default",fn:function(n){return[e("strong",[t._v(t._s(n.option.name)+"\n                        "+t._s(n.option.lastname))])]}},{key:"empty",fn:function(){return[t._v("\n                      Sin resultados\n                    ")]},proxy:!0},{key:"selected",fn:function(){return t._l(t.form.participants,(function(n,r){return e("b-tag",{key:r,attrs:{closable:""},on:{close:function(e){return t.removeParticipant(r)}}},[t._v("\n                        "+t._s(n.name)+" "+t._s(n.lastname)+"\n                      ")])}))},proxy:!0}]),model:{value:t.form.participants,callback:function(e){t.$set(t.form,"participants",e)},expression:"form.participants"}})],1)],1)])]),t._v(" "),e("div",{staticClass:"divider"},[e("strong",[t._v("Zona y vegetación")])]),t._v(" "),e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[e("b-field",{attrs:{label:"Zona involucrada"}},[e("b-taginput",{attrs:{data:t.filteredParticipants,field:"name",autocomplete:""},on:{typing:t.filterData},scopedSlots:t._u([{key:"default",fn:function(n){return[e("strong",[t._v(t._s(n.option.name)+"\n                      "+t._s(n.option.lastname))])]}},{key:"empty",fn:function(){return[t._v("\n                    Sin resultados\n                  ")]},proxy:!0},{key:"selected",fn:function(){return t._l(t.form.participants,(function(n,r){return e("b-tag",{key:r,attrs:{closable:""},on:{close:function(e){return t.removeParticipant(r)}}},[t._v("\n                      "+t._s(n.name)+" "+t._s(n.lastname)+"\n                    ")])}))},proxy:!0}]),model:{value:t.form.participants,callback:function(e){t.$set(t.form,"participants",e)},expression:"form.participants"}})],1)],1)]),t._v(" "),e("div",{staticClass:"divider"},[e("strong",[t._v("Coordenadas")])]),t._v(" "),e("div",{staticClass:"columns"},[e("div",{staticClass:"column is-4"},[e("div",{staticClass:"container"},[e("b-field",{attrs:{label:"Descripción breve de la coordenada"}},[e("b-input",{model:{value:t.formCoord.name,callback:function(e){t.$set(t.formCoord,"name",e)},expression:"formCoord.name"}})],1),t._v(" "),e("b-field",{attrs:{label:"Coordenada X"}},[e("b-numberinput",{attrs:{step:"0.000000000000000001",controls:!1},model:{value:t.point[0],callback:function(e){t.$set(t.point,0,e)},expression:"point[0]"}})],1),t._v(" "),e("b-field",{attrs:{label:"Coordenada Y"}},[e("b-numberinput",{attrs:{step:"0.000000000000000001",controls:!1},model:{value:t.point[1],callback:function(e){t.$set(t.point,1,e)},expression:"point[1]"}})],1)],1),t._v(" "),e("div",{staticClass:"container m-3 has-text-centered"},[e("b-button",{attrs:{type:"is-success is-light"},on:{click:t.addPoint}},[t._v("\n                  Agregar coordenada\n                ")])],1),t._v(" "),t._l(t.points,(function(n){return e("div",{key:n.name,staticClass:"container m-3"},[e("div",{staticClass:"control"},[e("b-tag",{attrs:{type:"is-primary",attached:"","aria-close-label":"Close tag",closable:""},on:{close:t.deletePoint,click:function(e){return t.viewPoint(n)}}},[t._v("\n                    "+t._s(n.name)+"\n                  ")])],1)])}))],2),t._v(" "),e("div",{staticClass:"column is-8"},[e("vl-map",{staticStyle:{height:"400px"},attrs:{"load-tiles-while-animating":!0,"load-tiles-while-interacting":!0,"data-projection":"EPSG:4326"}},[e("vl-view",{attrs:{zoom:t.zoom,center:t.point,rotation:t.rotation},on:{"update:zoom":function(e){t.zoom=e},"update:center":function(e){t.point=e},"update:rotation":function(e){t.rotation=e}}}),t._v(" "),e("vl-layer-tile",[e("vl-source-osm")],1),t._v(" "),e("vl-feature",[e("vl-geom-multi-point",{attrs:{coordinates:t.pointsMap}})],1)],1)],1)]),t._v(" "),e("div",{staticClass:"divider"},[e("strong",[t._v("Evidencias")])]),t._v(" "),e("div",{staticClass:"columns"},[e("div",{staticClass:"column is-6"},[e("section",[e("b-field",[e("b-upload",{attrs:{multiple:"","drag-drop":""},model:{value:t.files,callback:function(e){t.files=e},expression:"files"}},[e("section",{staticClass:"section"},[e("div",{staticClass:"content has-text-centered"},[e("p",[e("b-icon",{attrs:{icon:"upload",size:"is-large"}})],1),t._v(" "),e("p",[t._v("\n                          Arrastra aquí tus imágenes o has click aquí para\n                          subirlas.\n                        ")])])])])],1),t._v(" "),t._l(t.files,(function(n,r){return e("div",{key:n,staticClass:"tags"},[e("b-tag",{attrs:{type:"is-primary",attached:"","aria-close-label":"Borrar elemento",closable:""},on:{close:function(e){return t.deleteDropFile(r)},click:function(e){return t.viewIamge(n)}}},[t._v("\n                    "+t._s(r+1)+" - "+t._s(n.name)+"\n                  ")])],1)}))],2)]),t._v(" "),e("div",{staticClass:"column is-6"},[e("b-image",{attrs:{src:t.imageUrl,alt:"The Buefy Logo",ratio:"601by235"}})],1)])])]),t._v(" "),e("div",{staticClass:"card-footer"},[e("div",{staticClass:"card-footer-item"},[e("b-button",{attrs:{disabled:t.buttonDisabled},on:{click:t.closeModal}},[t._v("\n            Cancelar\n          ")])],1),t._v(" "),e("div",{staticClass:"card-footer-item"},[e("b-button",{attrs:{type:"is-success",disabled:t.buttonDisabled},on:{click:t.createBinnacle}},[t._v("\n            Guardar\n          ")])],1)])])],1)])}),[],!1,null,null,null);e.default=component.exports}}]);