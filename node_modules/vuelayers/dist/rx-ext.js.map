{"version":3,"file":"rx-ext.js","sources":["../src/rx-ext/observable.js","../src/rx-ext/operators.js"],"sourcesContent":["import { fromEventPattern, merge as mergeObs, Observable } from 'rxjs'\nimport { distinctUntilChanged, map as mapObs } from 'rxjs/operators'\nimport { identity, isEqual, isFunction } from '../utils'\n\n/**\n * Creates an Observable using OpenLayers event pattern that emits events coming from the given event target.\n *\n * @example **Subscribe on view center change events**\n * const map = ol.Map({ ... })\n * const changes = Observable.fromOlEvent(map.getView(), 'change:center')\n *\n * changes.subscribe(({ coordinate }) => console.log(coordinate))\n *\n * @param {module:ol/Observable~Observable} target OpenLayers event target.\n * @param {string|Object[]} eventName The event name of interest, being emitted by the `target`\n *                          or an array of events/selectors like `[{ event: 'event1', selector?: x => x }, ...]`.\n * @param {function(...*): *} [selector] An optional function to post-process results. It takes the arguments\n *    from the event handler and should return a single value.\n * @param {Observable[]} [pipeEach]\n * @return {Observable<T>}\n * @memberOf {Observable}\n */\nexport function fromOlEvent (target, eventName, selector, pipeEach = []) {\n  if (Array.isArray(eventName)) {\n    return mergeObs(\n      ...eventName.map(\n        elem => {\n          let eventName, selector\n\n          if (typeof elem === 'object') {\n            eventName = elem.event\n            selector = elem.selector\n          } else {\n            eventName = elem\n          }\n\n          return fromOlEvent(target, eventName, selector).pipe(...pipeEach)\n        },\n      ),\n    )\n  }\n\n  selector || (selector = identity)\n\n  return fromEventPattern(\n    handler => target.on(eventName, handler),\n    handler => target.un(eventName, handler),\n  ).pipe(mapObs(selector))\n}\n\n/**\n * Creates Observable from OpenLayers change:* event\n * @param {module:ol/Observable~Observable} target\n * @param {string|string[]} [prop]\n * @param {boolean|function(a, b):boolean|undefined} [distinct] Distinct values by isEqual fn or by custom comparator\n * @param {function|undefined} [selector] Custom selector\n * @param {Observable[]} [pipeEach]\n * @return {Observable<{prop: string, value: *}>}\n */\nexport function fromOlChangeEvent (\n  target,\n  prop,\n  distinct,\n  selector,\n  pipeEach = [],\n) {\n  if (Array.isArray(prop)) {\n    return mergeObs(...prop.map(p => fromOlChangeEvent(target, p, distinct, selector).pipe(...pipeEach)))\n  }\n\n  selector || (selector = identity)\n  const event = `change:${prop}`\n  const observable = fromOlEvent(target, event, () => target.get(prop))\n  const operations = []\n\n  if (distinct) {\n    isFunction(distinct) || (distinct = isEqual)\n    operations.push(distinctUntilChanged(distinct))\n  }\n\n  operations.push(mapObs(value => selector({ prop, value })))\n\n  return observable.pipe(...operations)\n}\n\nexport function fromVueEvent (target, eventName, selector) {\n  if (Array.isArray(eventName)) {\n    return mergeObs(\n      ...eventName.map(\n        elem => {\n          let eventName, selector\n\n          if (typeof elem === 'object') {\n            eventName = elem.event\n            selector = elem.selector\n          } else {\n            eventName = elem\n          }\n\n          return fromVueEvent(target, eventName, selector)\n        },\n      ),\n    )\n  }\n\n  selector || (selector = identity)\n\n  return fromEventPattern(\n    handler => target.$on(eventName, handler),\n    handler => target.$off(eventName, handler),\n  ).pipe(mapObs(selector))\n}\n\nexport function fromVueWatcher (target, exprOrFn, options = {}) {\n  return new Observable(s => {\n    return target.$watch(exprOrFn, (value, previous) => s.next({ value, previous }), options)\n  })\n}\n","import { debounceTime, map, tap } from 'rxjs/operators'\n\nexport function bufferDebounceTime (time = 0) {\n  return source => {\n    let bufferedValues = []\n\n    return source.pipe(\n      tap(value => bufferedValues.push(value)),\n      debounceTime(time),\n      map(() => bufferedValues),\n      tap(() => { bufferedValues = [] }),\n    )\n  }\n}\n"],"names":["fromOlEvent","target","eventName","selector","pipeEach","Array","isArray","mergeObs","map","elem","event","pipe","identity","fromEventPattern","handler","on","un","mapObs","fromOlChangeEvent","prop","distinct","p","observable","get","operations","isFunction","isEqual","push","distinctUntilChanged","value","fromVueEvent","$on","$off","fromVueWatcher","exprOrFn","options","Observable","s","$watch","previous","next","bufferDebounceTime","time","source","bufferedValues","tap","debounceTime"],"mappings":"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"}